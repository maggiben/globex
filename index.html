<!DOCTYPE html>
<html lang="en">

<head>
  <title>Scene Player</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta http-equiv='Cache-Control' content='no-cache, no-store, must-revalidate'>
  <meta http-equiv='Pragma' content='no-cache'>
  <meta http-equiv='Expires' content='0'>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/URI.js/1.18.10/URI.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/stats.js/r16/Stats.min.js"></script>

  <style>
    html, body {
      height: 100%;
      padding: 0;
      margin: 0;
      overflow: hidden;
    }

    .stats {
      position: absolute;
      top: 0;
      left: 0;
      z-index: 9999;
    }
    
    .stage canvas {
      width: 100vw;
      height: 100vh;
      z-index: -9999;
    }
  </style>
</head>
<body>
  <div class="stats" id="stats"></div>
  <div id="stage" class="stage"></div>
  <script src="https://unpkg.com/systemjs"></script>
  <script type="text/javascript">
    const config = {
      // baseURL: './src',
      // defaultExtension: 'js',
      transpiler: 'plugin-babel',
      map: {
        /* Babel */
        'plugin-babel': 'https://rawgit.com/systemjs/plugin-babel/master/plugin-babel.js',
        'systemjs-babel-build': 'https://rawgit.com/systemjs/plugin-babel/master/systemjs-babel-browser.js',
        'transform-class-properties': 'https://unpkg.com/babel-plugin-transform-class-properties',
        'transform-decorators': 'https://unpkg.com/babel-plugin-transform-decorators',
        'preset-env': 'https://unpkg.com/babel-preset-env',
        'stage-0': 'https://unpkg.com/babel-preset-stage-0',
        
        /* Loaders */
        'css': 'https://unpkg.com/systemjs-plugin-css',
        'json': 'https://unpkg.com/systemjs-plugin-json',

        /* libraries */
        'socket.io-client' : 'https://unpkg.com/socket.io-client/dist/socket.io.js',
        'three': 'https://unpkg.com/three/build/three.min.js',
        'three-orbitcontrols': 'https://unpkg.com/three-orbitcontrols/OrbitControls.js',
        'lodash': 'https://unpkg.com/lodash',
        'chance': 'https://unpkg.com/chance',
        'turf': 'https://unpkg.com/turf/turf.min.js',
        'tween': 'https://unpkg.com/tween.js/src/Tween.js',
        'tooloud': 'https://unpkg.com/tooloud/dist/tooloud.min.js'
      },
      meta: {
        'three': {
          format: 'global',
          exports: 'THREE', // the global property to take as the module value
        },
        'wagner/base': {
          format: 'global',
          deps: [
            // dependencies to load before this module
            'wagner/'
          ]
        },
        'wagner/': {
          format: 'global',
          exports: 'WAGNER', // the global property to take as the module value
          deps: [
            // dependencies to load before this module
            'THREE'
          ]
        }
      },
      packages: {
        './src': {
          defaultExtension: 'js',
          meta: {
            '*.css': { loader: 'css' },
            '*.json': { loader: 'json' }
          },
          map: {
            'timesync': 'https://unpkg.com/timesync/dist/timesync.min.js',
            'axios': 'https://unpkg.com/axios/dist/axios.min.js',
            'babelOptions': {
              'sourceMaps': true,
              'plugins': ['transform-class-properties', 'transform-decorators'],
              'presets': [
                'stage-0',
                'env', {
                  'targets': {
                    'browsers': ['last 2 versions']
                  }
                }
              ]
            }
          }
        }
      }
    };

    const { protocol, hostname, port,pathname } = window.location;
    const query = URI.buildQuery({
      'epoch': Date.now()
    });
    const uri = new URI().directory(pathname.concat('src')).filename('Main.js').query(query);
    console.info('loading entry point: ', uri.toString());
    SystemJS.config(config);
    SystemJS.import(uri.resource());
  </script>
</body>

</html>
